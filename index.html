<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#ED9BC4">
    <meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>Guerrilla Fashion Soundboard</title>
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="icon" type="image/png" href="favicon.ico">
    <link rel="manifest" href="manifest.json">
    <style>
        @font-face {
            font-family: FUCXEDCAPS;
            src: url('fonts/FUCXEDCAPSLATIN.OTF');
        }
        @font-face {
            font-family: Karla;
            src: url('fonts/Karla.ttf');
        }
        * {
            font-family: FUCXEDCAPS;
            font-size: 5.5vw;
            margin: 1%;
        }
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: #ED9BC4;
        }
        img {
            width: 48%;
        }
        button {
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            background-color: #000000;
            color: #ffffff;
            padding: 8%;
            border: none;
            cursor: pointer;
            border-radius: 16px;
            width: 48%;
            height: 100%;
		    transition: background-color 0.3s;
        }
        button:hover {
            color: #000000;
            background-color: #FFC11E;
        }
        .button-row {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }
        .play-all-button {
            width: 96%;
        }
        .playing {
            background-color: #14AA37;
            color: #ffffff;
        }
        .playing-all {
            background-color: #14AA37;
            color: #ffffff;
        }
		.tekst {
			font-family: Karla;
            font-size: 3vw;
			text-align: center;
			max-width: 96%;
		}
		.link {
			font-family: Karla;
            font-size: 3vw;
		    color: #75d0f1;
			text-align: center;
			max-width: 96%;
		}
		.link:hover {
			background-color: #cce7ff;
		}
    </style>
</head>
<body>
    <img role="banner" src="logos/gf_logo.png" alt="Guerrilla Fashion logo">
    <div class="button-row" id="soundboard"></div>
    <button class="play-all-button" onclick="playAllSounds()" aria-label="Speel alle geluiden achter elkaar af">Play All</button>
    <div id="audioPlayer"><audio id="audio"></audio></div>
	<div class="tekst">Touch to play / Hold to download</div>
	<div class="tekst">Klik<a href="https://extinctionrebellion.nl/guerrilla-fashion/" class="link">hier</a>voor meer informatie</div>
    <script>
        const soundboard = document.getElementById('soundboard');
        const audio = document.getElementById("audio");
        const playAllButton = document.querySelector(".play-all-button");

        let sounds = [];
        let currentPlayingButton = null;
        let playingAll = false;
        let index = 0;
        let pressTimer = null;
        let longPressTriggered = false;

        fetch('getSounds.php')
            .then(response => response.json())
            .then(data => {
                sounds = data;
                generateButtons();
            });

        function generateButtons() {
            sounds.forEach(sound => {
                const button = document.createElement('button');
                button.className = "sound-button";
		        button.innerText = sound.substring(3);
                button.setAttribute("aria-label", `Speel geluid: ${sound}`);
                button.title = "Tik om af te spelen of te stoppen. Houd ingedrukt om te downloaden.";

                button.addEventListener("pointerdown", (event) => startPress(event, sound, button));
                button.addEventListener("pointerup", (event) => endPress(event, sound, button));

                soundboard.appendChild(button);
            });
        }

        function toggleSound(button, soundName) {
            const soundSrc = `sounds/GF_${soundName}.mp3`;

            if (audio.src.includes(soundName) && !audio.paused) {
                audio.pause();
                audio.currentTime = 0;
		        button.innerText = soundName.substring(3);
                button.classList.remove("playing");
                currentPlayingButton = null;
                audio.src = "";
                return;
            }

            if (currentPlayingButton) {
                currentPlayingButton.innerText = currentPlayingButton.dataset.originalText;
                currentPlayingButton.classList.remove("playing");
            }

            audio.src = soundSrc;
            audio.load();

            const expectedSrc = audio.src;

            audio.oncanplaythrough = () => {
                if (audio.src === expectedSrc) {
                    audio.play().catch(error => {
                        console.warn("Audio kon niet worden afgespeeld:", error);
                    });
                }
            };

            button.dataset.originalText = button.innerText;
            button.innerText = "Stop";
            button.classList.add("playing");
            currentPlayingButton = button;
        }

        function startPress(event, soundName, button) {
            longPressTriggered = false;
            pressTimer = setTimeout(() => {
                downloadSound(soundName);
                longPressTriggered = true;
            }, 1500);
        }

        function endPress(event, soundName, button) {
            clearTimeout(pressTimer);
            if (!longPressTriggered) {
                toggleSound(button, soundName);
            }
        }

        function downloadSound(name) {
            const link = document.createElement("a");
            link.href = `sounds/GF_${name}.mp3`;
            link.download = `GF_${name}.mp3`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function playAllSounds() {
            if (playingAll) {
                playingAll = false;
                audio.pause();
                audio.currentTime = 0;
                playAllButton.innerText = "Play All";
                playAllButton.classList.remove("playing-all");
                audio.onended = null;
            } else {
                if (currentPlayingButton) {
                    currentPlayingButton.innerText = currentPlayingButton.dataset.originalText;
                    currentPlayingButton.classList.remove("playing");
                    currentPlayingButton = null;
                }

                playingAll = true;
                playAllButton.classList.add("playing-all");
                index = 0;

                function playNextSound() {
                    if (playingAll && index < sounds.length) {
                        audio.src = `sounds/GF_${sounds[index++]}.mp3`;
                        audio.load();
                        audio.oncanplaythrough = () => {
                            audio.play();
                        };
                    } else {
                        playingAll = false;
                        playAllButton.innerText = "Play All";
                        playAllButton.classList.remove("playing-all");
                    }
                }

                audio.onended = playNextSound;
                playAllButton.innerText = "Stop All";
                playNextSound();
            }
        }

        audio.addEventListener("ended", () => {
            if (currentPlayingButton) {
                currentPlayingButton.innerText = currentPlayingButton.dataset.originalText;
                currentPlayingButton.classList.remove("playing");
                currentPlayingButton = null;
            }
        });
    </script>
</body>
</html>
